import{f as ut}from"../chunks/fetch-refresh.CoktrdpI.js";import{e as st,s as _t}from"../chunks/index.DJuFnhGY.js";import{i as pt,l as gt,r as ot,h as J,s as ht,a as i,f as x,t as m,b as F,c as f,d as H,e as r}from"../chunks/disclose-version.B-hLH5kf.js";import{A as lt,r as Z,g as t,F as yt,a8 as wt,L as mt,d as T,p as Pt,l as V,c as bt,a as kt,m as B,s as c,a9 as $t,b as tt}from"../chunks/runtime.DDjRgbeA.js";import{i as M}from"../chunks/if.BIDFABO2.js";import{a as St}from"../chunks/actions.B3legGYV.js";import{b as Ft}from"../chunks/this.BVWmpjgx.js";import{i as xt}from"../chunks/lifecycle.Dwr_-_8E.js";import{u as Nt,s as qt,p as Rt}from"../chunks/stores.CP4a9a7K.js";import{e as Bt}from"../chunks/forms.CEJNioRk.js";import{i as it,a as nt}from"../chunks/entry.C4uEBCSM.js";import{B as U}from"../chunks/Button.Dse6T-Vv.js";import"../chunks/HeaderNav.svelte_svelte_type_style_lang.BOaGD4ME.js";import{I as Lt}from"../chunks/ItemPage.C-H0ZPAG.js";import{T as Ot}from"../chunks/Player.CEPOGhM8.js";import{t as dt}from"../chunks/toasts.cn0VEhPp.js";import{P as Tt}from"../chunks/PlaylistForm.D-Hu4pxy.js";import{M as jt}from"../chunks/Modal.Hglc8NYm.js";import{l as ft}from"../chunks/micromodal.es.CJCzk-G3.js";import{l as It,s as At}from"../chunks/props.GCjS4c-Y.js";import{I as Et}from"../chunks/Icon.gh31iTKL.js";function Mt(v,a){const n=v.dom;if(mt(n)){for(let d=n.length-1;d>=0;d--)if(a.includes(n[d])){n.splice(d,1);break}}else n!==null&&a.includes(n)&&(v.dom=null)}function Ut(v,a,n,d){var s;const y=v.parentNode!==((s=lt)==null?void 0:s.dom)?lt:null;let e=T(a);Z(()=>{var o=Jt(v,y,t(e));if(o)return()=>{y!==null&&Mt(y,mt(o)?o:[o]),yt(o)}})}function Jt(v,a,n,d,y){if(pt)return gt;var e=n+"",s=wt(e);if(s.childNodes.length===1){var o=s.firstChild;return v.before(o),a!==null&&ot(o,a),o}var w=[...s.childNodes];return v.before(s),a!==null&&ot(w,a),w}function Ct(v,a){const n=It(a,["children","$$slots","$$events"]),d=[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"}]];var y=J(),e=x(y);Et(e,At({name:"heart"},()=>n,{iconNode:d,children:(s,o)=>{var w=J(),R=x(w);ht(R,a.children,{}),i(s,w)}})),i(v,y)}const zt=async({fetch:v,params:a,depends:n,route:d,url:y,parent:e})=>{n(`app:${d.id}`);const{user:s}=await e(),o=P=>ut(v,P),w=100,R=y.searchParams.get("page"),[j,C]=await Promise.all([o(`/api/spotify/playlists/${a.id}`),o(`/api/spotify/playlists/${a.id}/followers/contains?${new URLSearchParams({ids:s?s.id:""}).toString()}`)]);if(!j.ok)throw st(j.status,"Failed to load playlist!");let L=null;C.ok&&(L=(await C.json())[0]);const I=await j.json();if(R&&R!=="1"){const P=await o(`/api/spotify/playlists/${a.id}/tracks?${new URLSearchParams({limit:`${w}`,offset:`${w*(Number(R)-1)}`}).toString()}`);if(!P.ok)throw st(P.status,"Failed to load playlist!");const W=await P.json();I.tracks=W}let Q=null;if(I.images.length>0){const P=await o(`/api/average-color?${new URLSearchParams({image:I.images[0].url}).toString()}`);P.ok&&(Q=(await P.json()).color)}return{playlist:I,color:Q,title:I.name,isFollowing:L}},Fa=Object.freeze(Object.defineProperty({__proto__:null,load:zt},Symbol.toStringTag,{value:"Module"}));var Dt=m("Edit Playlist",1),Ht=m('<!> <span class="visually-hidden"> </span>',1),Vt=m('<p class="error svelte-1q4ivft"> </p>'),Zt=m('<form class="follow-form svelte-1q4ivft" method="POST"><!> <!></form>'),Gt=m('Load More <span class="visually-hidden">Tracks</span>',1),Kt=m('<div class="load-more svelte-1q4ivft"><!></div>'),Qt=m("← Previous Page",1),Wt=m("Next Page →",1),Xt=m('<!> <!> <div class="pagination svelte-1q4ivft"><div class="previous"><!></div> <div class="next"><!></div></div>',1),Yt=m("Search for Content",1),ta=m("View all Playlists",1),aa=m('<div class="empty-playlist svelte-1q4ivft"><p class="svelte-1q4ivft">No items added to this playlist yet.</p> <!> <!></div>'),ea=m('<div class="playlist-actions svelte-1q4ivft"><!></div> <!>',1),ra=m('<div slot="meta"><p class="playlist-description svelte-1q4ivft"><!></p> <p class="meta svelte-1q4ivft"><span class="svelte-1q4ivft"> </span> <span class="svelte-1q4ivft"> </span> <span class="svelte-1q4ivft"> </span></p></div>'),sa=m("<!> <!>",1);function xa(v,a){Pt(a,!1);const n={};Nt(n);const d=()=>qt(Rt,"$page",n),y=B(),e=B(),s=B(),o=B(),w=B();let R=B(!1),j=B(!1),C=B(),L=B();const I=Intl.NumberFormat("en",{notation:"compact"}),Q=async()=>{if(!t(s).next)return;c(R,!0);const k=await fetch(t(s).next.replace("https://api.spotify.com/v1/","/api/spotify/")),z=await k.json();k.ok?c(s,{...z,items:[...t(s).items,...z.items]}):dt.error(z.error.message||"Could not load data!"),c(R,!1)};V(()=>tt(a.data),()=>{c(y,a.data.color)}),V(()=>tt(a.data),()=>{c(e,a.data.playlist)}),V(()=>tt(a.data),()=>{c(s,a.data.playlist.tracks)}),V(()=>tt(a.data),()=>{c(o,a.data.isFollowing)}),V(()=>d(),()=>{c(w,d().url.searchParams.get("page")||1)}),V(()=>(t(L),t(s)),()=>{c(L,[]),t(s).items.forEach(k=>{k.track&&c(L,[...t(L),k.track])})}),bt(),xt();var P=sa(),W=x(P),vt=T(()=>t(e).images.length>0?t(e).images[0].url:void 0);Lt(W,{get title(){return t(e).name},get image(){return t(vt)},get color(){return t(y)},get type(){return t(e).type},children:(k,z)=>{var O=ea(),A=x(O),G=f(A);M(G,()=>{var u;return((u=a.data.user)==null?void 0:u.id)===t(e).owner.id},u=>{var _=J(),$=x(_);U($,{element:"a",variant:"outline",get href(){return`/playlist/${F(t(e).id)}/edit`},$$events:{click:b=>{b.preventDefault(),ft.show("edit-playlist-modal")}},children:(b,S)=>{var p=Dt();i(b,p)}}),i(u,_)},u=>{var _=J(),$=x(_);M($,()=>t(o)!==null,b=>{var S=Zt(),p=f(S);Ft(U(p,{element:"button",type:"submit",variant:"outline",get disabled(){return t(j)},children:(l,N)=>{var D=Ht(),X=x(D),g=T(()=>t(o)?"var(--text-color)":"none");Ct(X,{"aria-hidden":!0,focusable:"false",get fill(){return t(g)}});var h=r(X,!0),q=r(h),E=f(q);Z(()=>{H(h,` ${F(t(o)?"Unfollow":"Follow")} `),H(E,`${F(t(e).name)} playlist`)}),i(l,D)}}),l=>c(C,l),()=>t(C));var K=r(r(p,!0));M(K,()=>{var l;return a.form&&"followForm"in a.form&&((l=a.form)==null?void 0:l.followError)},l=>{var N=Vt(),D=f(N);Z(()=>H(D,a.form.followError)),i(l,N)}),Z(()=>_t(S,"action",`?/${t(o)?"unFollowPlaylist":"followPlaylist"}`)),St(S,(l,N)=>Bt(l,N),()=>()=>(c(j,!0),async({result:l})=>{var N;c(j,!1),l.type==="success"?(await nt(l),c(o,!t(o))):l.type==="failure"?(dt.error((N=l.data)==null?void 0:N.followError),await $t()):await nt(l),t(C).focus(),it()})),i(b,S)},null,!0),i(u,_)});var at=r(r(A,!0));M(at,()=>t(e).tracks.items.length>0,u=>{var _=Xt(),$=x(_),b=T(()=>{var g;return((g=a.data.user)==null?void 0:g.id)===t(e).owner.id}),S=T(()=>{var g;return(g=a.data.userAllPlaylists)==null?void 0:g.filter(h=>{var q;return h.owner.id===((q=a.data.user)==null?void 0:q.id)})});Ot($,{get tracks(){return t(L)},get isOwner(){return t(b)},get userPlaylists(){return t(S)},get title(){return t(e).name},get total(){return t(e).tracks.total}});var p=r(r($,!0));M(p,()=>t(s).next,g=>{var h=Kt(),q=f(h);U(q,{element:"button",variant:"outline",get disabled(){return t(R)},$$events:{click:Q},children:(E,Y)=>{var et=Gt();i(E,et)}}),i(g,h)});var K=r(r(p,!0)),l=f(K),N=f(l);M(N,()=>t(s).previous,g=>{var h=J(),q=x(h),E=T(()=>`${F(d().url.pathname)}?${F(new URLSearchParams({page:`${Number(t(w))-1}`}).toString())}`);U(q,{variant:"outline",element:"a",get href(){return t(E)},children:(Y,et)=>{var rt=Qt();i(Y,rt)}}),i(g,h)});var D=r(r(l,!0)),X=f(D);M(X,()=>t(s).next,g=>{var h=J(),q=x(h),E=T(()=>`${F(d().url.pathname)}?${F(new URLSearchParams({page:`${Number(t(w))+1}`}).toString())}`);U(q,{variant:"outline",element:"a",get href(){return t(E)},children:(Y,et)=>{var rt=Wt();i(Y,rt)}}),i(g,h)}),i(u,_)},u=>{var _=aa(),$=f(_),b=r(r($,!0));U(b,{element:"a",href:"/search",children:(p,K)=>{var l=Yt();i(p,l)}});var S=r(r(b,!0));U(S,{element:"a",href:"/playlists",children:(p,K)=>{var l=ta();i(p,l)}}),i(u,_)}),i(k,O)},$$slots:{meta:(k,z)=>{var O=ra(),A=f(O),G=f(A);Ut(G,()=>t(e).description);var at=r(r(A,!0)),u=f(at),_=f(u),$=r(r(u,!0)),b=f($);Z(()=>H(b,`${F(I.format(t(e).followers.total))} Followers`));var S=r(r($,!0)),p=f(S);Z(()=>{H(_,t(e).owner.display_name),H(p,`${F(t(e).tracks.total)} Tracks`)}),i(k,O)}}});var ct=r(r(W,!0));jt(ct,{id:"edit-playlist-modal",get title(){return`Edit ${F(t(e).name)}`},children:(k,z)=>{var O=J(),A=x(O),G=T(()=>a.form&&"editForm"in a.form?a.form:null);Tt(A,{get action(){return`/playlist/${F(t(e).id)}/edit`},get playlist(){return t(e)},get form(){return t(G)},$$events:{success:()=>{ft.close("edit-playlist-modal"),it()}}}),i(k,O)}}),i(v,P),kt()}export{xa as component,Fa as universal};
